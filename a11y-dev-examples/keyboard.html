<!doctype html>
<html lang="en">

<head>
  <title>Keyboard and controls</title>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <style media="screen">
  legend, [role=radiogroup] h3 {
      display: block;
      width: 100%;
      max-width: 100%;
      padding: 0;
      margin-bottom: .5rem;
      font-size: 1.5rem;
      line-height: inherit;
      color: inherit;
      white-space: normal;
}
  [role=radio] {
    display: block;
    position: relative;
    margin: 0.5em;
    padding-left: 20px;
    border: thin transparent solid;
    cursor:pointer;
  }

  /* This creates the visuals for the radio buttons */
  [role=radio]::before,
  [role=radio]::after {
    display: block;
    position: absolute;
    border-radius: 50%;
    content: '';
  }

  [role=radio]::before {
    top: 0;
    left: 0;
    width: 14px;
    height: 14px;
    border: 1px solid #000;
    background: #fff;
  }

  [role=radio][aria-checked=true]::after {
    top: 3px;
    left: 3px;
    border: 4px solid #000;
    content: '';
  }
  .link {
    color:#007bff;
  }
  .link:focus, .link:hover {
      cursor: pointer;
      text-decoration: underline;
  }

  </style>
  <!-- Bootstrap CSS -->
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/css/bootstrap.min.css" integrity="sha384-PsH8R72JQ3SOdhVi3uxftmaW6Vc51MKb0q5P2rRUpPvrszuE4W1povHYgTpBfshb" crossorigin="anonymous">
</head>

<body>
  <div class="container">
    <br><br>
    <h2>Buttons</h2>
    <p>Below some common controls - on the left the native control, on the right the closest synthetic equivalent.</p>
    <p>Think of the instrumentation you will need to add to the synthetic element so that it will be perceived as the native correlate, and so that it will be able to be operated as a native control.</p>
    <p>Then take a look at the source (or inspect things) to see. Maybe we are better off with native controls? You be the judge.</p>
    <h2>Buttons and links</h2>
    <div class="row">
      <div class="col-sm">
        <button type="button" name="button" class="btn btn-primary" id="realbutton">A real button</button>
      </div>
      <div class="col-sm">
        <div class="btn btn-primary" role="button" tabindex="0" id="unrealbutton">An unreal button</div>
      </div>
    </div>
    <br>
    <div class="row">
      <div class="col-sm">
        <a href="http://www.w3c.org" target="_blank">A real link</a>
      </div>
      <div class="col-sm">
        <span href="http://www.w3c.org" onkeydown="navigateLink(event)" onclick="navigateLink(event)" tabindex="0" id="link1" role="link" class="link">An unreal link</span>
      </div>
    </div>


    <br>
    <h2>Selects</h2>
    <div class="row">
      <div class="col-sm">
        <select class="form-control" name="">
            <option value="">A real select</option>
            <option value="">Action</option>
            <option value="">Another action</option>
          </select>
      </div>
      <div class="col-sm">
        <div class="dropdown">
          <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
              An unreal select
            </button>
          <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
            <a class="dropdown-item" href="#">Action</a>
            <a class="dropdown-item" href="#">Another action</a>
            <a class="dropdown-item" href="#">Something else here</a>
          </div>
        </div>
      </div>
    </div>
    <br>
    <h2>Radio groups</h2>
    <div class="row">
      <div class="col-sm">



        <fieldset>
          <legend>A real radiogroup</legend>
          <div class="form-group">
            <div class="form-check">
              <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios1" value="option1" checked>
              <label class="form-check-label" for="exampleRadios1">
                Default radio
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios2" value="option2">
              <label class="form-check-label" for="exampleRadios2">
                Second default radio
              </label>
            </div>
            <div class="form-check">
              <input class="form-check-input" type="radio" name="exampleRadios" id="exampleRadios3" value="option3">
              <label class="form-check-label" for="exampleRadios3">
                Third radio
              </label>
            </div>
          </div>
        </fieldset>

      </div>
      <div class="col-sm">
        <div role="radiogroup"
             aria-labelledby="gdesc1"
            >
          <h3>
            An unreal radiogroup
          </h3>
          <div role="radio"
               aria-checked="false"
               tabindex="0">
             Default radio
          </div>
          <div role="radio"
               aria-checked="false"
               tabindex="-1">
             Another default radio
          </div>
          <div role="radio"
               aria-checked="false"
               tabindex="-1">
             Third radio
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Optional JavaScript -->
  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.3/umd/popper.min.js" integrity="sha384-vFJXuSJphROIrBnz7yo7oB41mKfc8JzQZiCq4NCceLEaO4IHwicKwpJf9c9IpFgh" crossorigin="anonymous"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta.2/js/bootstrap.min.js" integrity="sha384-alpBpkh1PFOepccYVYDB4do5UnbKysX5WZXm3XxPqe5iKTfUKjNkCk9SaVuEZflJ" crossorigin="anonymous"></script>
  <script src="https://dequeuniversity.com/assets/js/patterns/deque-patterns.min.js"></script>

  <script type="text/javascript">
    $('#unrealbutton, #realbutton').on('click, keypress', function(e) {
      alert('Server down!');
    });
    var KEYCODE = {
        DOWN: 40,
        LEFT: 37,
        RIGHT: 39,
        SPACE: 32,
        UP: 38
    }

    window.addEventListener('load', function() {

      var radiobuttons = document.querySelectorAll('[role=radio]');

      for(var i = 0; i < radiobuttons.length; i++ ) {
        var rb = radiobuttons[i];

        console.log(rb.tagName + " " + rb.id)

        rb.addEventListener('click', clickRadioGroup);
        rb.addEventListener('keydown', keyDownRadioGroup);
        rb.addEventListener('focus', focusRadioButton);
        rb.addEventListener('blur', blurRadioButton);
      }

    });

    /*
    * @function firstRadioButton
    *
    * @desc Returns the first radio button
    *
    * @param   {Object}  event  =  Standard W3C event object
    */

    function firstRadioButton(node) {

      var first = node.parentNode.firstChild;

      while(first) {
        if (first.nodeType === Node.ELEMENT_NODE) {
          if (first.getAttribute("role") === 'radio') return first;
        }
        first = first.nextSibling;
      }

      return null;
    }

    /*
    * @function lastRadioButton
    *
    * @desc Returns the last radio button
    *
    * @param   {Object}  event  =  Standard W3C event object
    */

    function lastRadioButton(node) {

      var last = node.parentNode.lastChild;

      while(last) {
        if (last.nodeType === Node.ELEMENT_NODE) {
          if (last.getAttribute("role") === 'radio') return last;
        }
        last = last.previousSibling;
      }

      return last;
    }

    /*
    * @function nextRadioButton
    *
    * @desc Returns the next radio button
    *
    * @param   {Object}  event  =  Standard W3C event object
    */

    function nextRadioButton(node) {

      var next = node.nextSibling;

      while(next) {
        if (next.nodeType === Node.ELEMENT_NODE) {
          if (next.getAttribute("role") === 'radio') return next;
        }
        next = next.nextSibling;
      }

      return null;
    }

    /*
    * @function previousRadioButton
    *
    * @desc Returns the previous radio button
    *
    * @param   {Object}  event  =  Standard W3C event object
    */

    function previousRadioButton(node) {

      var prev = node.previousSibling;

      while(prev) {
        if (prev.nodeType === Node.ELEMENT_NODE) {
          if (prev.getAttribute("role") === 'radio') return prev;
        }
        prev = prev.previousSibling;
      }

      return null;
    }

    /*
    * @function getImage
    *
    * @desc Gets the image for radio box
    *
    * @param   {Object}  event  =  Standard W3C event object
    */

    function getImage(node) {

      var child = node.firstChild;

      while(child) {
        if (child.nodeType === Node.ELEMENT_NODE) {
          if (child.tagName === 'IMG') return child;
        }
        child = child.nextSibling;
      }

      return null;
    }

    /*
    * @function setRadioButton
    *
    * @desc Toogles the state of a radio button
    *
    * @param   {Object}  event  -  Standard W3C event object
    *
    */

    function setRadioButton(node, state) {
      var image = getImage(node);

      if (state == 'true') {
        node.setAttribute('aria-checked', 'true')
        node.tabIndex = 0;
        node.focus()
      }
      else {
        node.setAttribute('aria-checked', 'false')
        node.tabIndex = -1;
      }
    }

    /*
    * @function clickRadioGroup
    *
    * @desc
    *
    * @param   {Object}  node  -  DOM node of updated group radio buttons
    */

    function clickRadioGroup(event) {
      var type = event.type;

      if (type === 'click') {
        // If either enter or space is pressed, execute the funtion

        var node = event.currentTarget;

        var radioButton = firstRadioButton(node);

        while (radioButton) {
          setRadioButton(radioButton, "false");
          radioButton = nextRadioButton(radioButton);
        }

        setRadioButton(node, "true");

        event.preventDefault();
        event.stopPropagation();
      }
    }

    /*
    * @function keyDownRadioGroup
    *
    * @desc
    *
    * @param   {Object}   node  -  DOM node of updated group radio buttons
    */

    function keyDownRadioGroup(event) {
      var type = event.type;
      var next = false;

      if(type === "keydown"){
        var node = event.currentTarget;

        switch (event.keyCode) {
          case KEYCODE.DOWN:
          case KEYCODE.RIGHT:
            var next = nextRadioButton(node);
            if (!next) next = firstRadioButton(node); //if node is the last node, node cycles to first.
            break;

          case KEYCODE.UP:
          case KEYCODE.LEFT:
            next = previousRadioButton(node);
            if (!next) next = lastRadioButton(node); //if node is the last node, node cycles to first.
            break;

          case KEYCODE.SPACE:
            next = node;
            break;
        }

        if (next) {
          var radioButton = firstRadioButton(node);

          while (radioButton) {
            setRadioButton(radioButton, "false");
            radioButton = nextRadioButton(radioButton);
          }

          setRadioButton(next, "true");

          event.preventDefault();
          event.stopPropagation();
        }
      }
    }

    /*
    * @function focusRadioButton
    *
    * @desc Adds focus styling to label element encapsulating standard radio button
    *
    * @param   {Object}  event  -  Standard W3C event object
    */

    function focusRadioButton(event) {
      event.currentTarget.className += ' focus';
    }

    /*
    * @function blurRadioButton
    *
    * @desc Adds focus styling to the label element encapsulating standard radio button
    *
    * @param   {Object}  event  -  Standard W3C event object
    */

    function blurRadioButton(event) {
       event.currentTarget.className = event.currentTarget.className.replace(' focus','');
    }

  </script>

  <script type="text/javascript">
  sap = {ui:{keycodes:{SPACE:32, ENTER:13 }}};
  //handles clicks and keydowns on the link
  function navigateLink(evt) {
      if (evt.type=="click" ||
          evt.keyCode == sap.ui.keycodes.ENTER) {
          var ref = evt.target != null ? evt.target : evt.srcElement;
          if (ref) window.open(ref.getAttribute("href"),"_blank");
      }
  }
  </script>

</body>

</html>
